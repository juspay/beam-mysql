name: beam-mysql
allowed-paths:
- src
- test
- db
- pool
- beam-mysql.cabal
- LICENSE
allow-newer: true

dependencies:
  euler-build:
    branch: ghc924
    revision: 9943d5f7013ce32efcc9920773b204c6fcf0ebc8

overrides:
  word24:
    owner: winterland1989
    repo: word24
    branch: master
    source: github
    commit: 445f791e35ddc8098f05879dbcd07c41b115cb39
    sha256: 19xm3w8f7kyr6g5rhnywis2piwjzc4wjfspsjrp91qq99gbx4zjb
  wire-streams:
    jailbreak: true
  binary-parsers:
    jailbreak: true
  mysql-haskell:
    jailbreak: true

build-tools:
- coreutils
- zlib
# moved to `custom-nix`
# - mysql57
# - numactl

nix-shell-tools:
- mysql80
- zlib
# - haskellPackages.cabal-fmt
# - ghcide
# - ghcide-ghc883

custom-nix:
  insert-binding: |-
    isDarwin = super.stdenv.isDarwin;
    linuxBuildTools = with super; lib.optionals (!isDarwin) [ mysql80 numactl ];
    dontCheckDarwin =
      if isDarwin then super.haskell.lib.dontCheck else x: x;

  wrap-default-package:
    left: |-
      dontCheckDarwin (super.haskell.lib.addBuildTools (
    right: |-
      ) linuxBuildTools)

