name: beam-mysql
allowed-paths:
- src
- test
- db
- pool
- beam-mysql.cabal
- LICENSE


dependencies:
  euler-build:
    branch: ghc924
    revision: 9943d5f7013ce32efcc9920773b204c6fcf0ebc8
  beam:
    branch: master
    revision: 53c98520169472d288bc987a4b7731966348de0b

overrides:
  word24:
    owner: winterland1989
    repo: word24
    branch: master
    source: github
    commit: 445f791e35ddc8098f05879dbcd07c41b115cb39
    sha256: 19xm3w8f7kyr6g5rhnywis2piwjzc4wjfspsjrp91qq99gbx4zjb
  record-dot-preprocessor:
    version: 0.2.15
    source: hackage
    sha256: 1kah6infl4nyzabd63g5cllcx5rg0vsp6shml435bvam9yhvbqg5

  bytestring-lexing:
    source: github
    owner: juspay
    repo: bytestring-lexing
    commit: 0a46db1139011736687cb50bbd3877d223bcb737
    sha256: 1jrwhlp8xs4m21xfr843278j3i7h4sxyjpq67l6lzc36pqan9zlz
    jailbreak: true
  mysql-haskell:
    source: github
    owner: juspay
    repo: mysql-haskell
    commit: 788022d65538db422b02ecc0be138b862d2e5cee
    sha256: 030qq1hgh15zkwa6j6x568d248iyfaw5idj2hh2mvb7j8xd1l4lv
    jailbreak: true
  binary-parsers:
    jailbreak: true
  wire-streams:
    jailbreak: true

build-tools:
- coreutils
- zlib
# moved to `custom-nix`
# - mysql57
# - numactl

nix-shell-tools:
- mysql80
- zlib
# - haskellPackages.cabal-fmt
# - ghcide
# - ghcide-ghc883

custom-nix:
  insert-binding: |-
    isDarwin = super.stdenv.isDarwin;
    linuxBuildTools = with super; lib.optionals (!isDarwin) [ mysql80 numactl ];
    dontCheckDarwin =
      if isDarwin then super.haskell.lib.dontCheck else x: x;

  wrap-default-package:
    left: |-
      dontCheckDarwin (super.haskell.lib.addBuildTools (
    right: |-
      ) linuxBuildTools)


